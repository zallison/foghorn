<!DOCTYPE html>
<html>
<head>
    <title>Foghorn Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <style>
        pre.code-block {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <script>
        function renderJson(targetId, data) {
            const pretty = JSON.stringify(data, null, 2);
            document.getElementById(targetId).innerHTML = `<pre class="code-block"><code class="language-json">${pretty}</code></pre>`;
            Prism.highlightElement(document.querySelector(`#${targetId} code.language-json`));
        }

        async function updateData() {
            try {
                const statsResp = await fetch('/stats');
                if (statsResp.ok) {
                    const statsData = await statsResp.json();
                    renderJson('stats', statsData);
                }
            } catch (e) {
                console.error('Failed to fetch /stats', e);
            }

            try {
                const logsResp = await fetch('/logs');
                if (logsResp.ok) {
                    const logsData = await logsResp.json();
                    renderJson('logs', logsData);
                }
            } catch (e) {
                console.error('Failed to fetch /logs', e);
            }

            try {
                const trafficResp = await fetch('/traffic');
                if (trafficResp.ok) {
                    const trafficData = await trafficResp.json();
                    renderJson('traffic', trafficData);
                }
            } catch (e) {
                console.error('Failed to fetch /traffic', e);
            }

            setTimeout(updateData, 5000);
        }
        window.onload = updateData;
    </script>
</head>
<body>
    <h1>Foghorn Dashboard</h1>
    <h2>Statistics</h2>
    <div id="stats"></div>
    <h2>Logs</h2>
    <div id="logs"></div>
    <h2>Traffic</h2>
    <div id="traffic"></div>
</body>
</html>