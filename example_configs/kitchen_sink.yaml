upstreams:
  endpoints:
  - host: 8.8.8.8
    port: 53
    transport: udp
  - host: 8.8.4.4
    port: 53
    transport: tcp
    pool:
      max_connections: 32
      idle_timeout_ms: 15000
  - host: 1.1.1.1
    port: 853
    transport: dot
    tls:
      server_name: cloudflare-dns.com
      verify: true
    pool:
      max_connections: 64
      idle_timeout_ms: 30000
  - transport: doh
    url: https://dns.google/dns-query
    method: POST
    headers:
      user-agent: foghorn
    tls:
      verify: true
  strategy: failover
  max_concurrent: 1
logging:
  level: info
  stderr: true
plugins:
- type: docker-hosts
  config:
    endpoints:
    - unix:///var/run/docker.sock
    docker_binary: docker
    ttl: 300
    reload_interval_seconds: 60
- type: hosts
  config:
    allow:
    - 192.0.2.0/24
    - 2001:db8::/32
    servfail_percent: 5.0
    nxdomain_percent: 2.0
    apply_to_qtypes:
    - A
    - AAAA
- type: file_downloader
  config:
    setup_priority: 15
    download_path: ./config/var/lists
    interval_days: 1
    urls:
    - https://v.firebog.net/hosts/AdguardDNS.txt
    - https://v.firebog.net/hosts/Easylist.txt
    - https://v.firebog.net/hosts/Prigent-Ads.txt
    - https://v.firebog.net/hosts/Prigent-Malware.txt
- type: filter
  config:
    setup_priority: 20
    default: deny
    db_path: ./config/var/blocklist.db
    cache_ttl_seconds: 600
    blocked_domains:
    - tracker.example
    allowed_domains:
    - intranet.example
    blocked_patterns:
    - .*\.ads\..*
    blocked_keywords:
    - gambling
    blocked_ips:
    - ip: 198.51.100.0/24
      action: remove
    - ip: 203.0.113.5
      action: replace
      replace_with: 127.0.0.1
    blocked_domains_files:
    - ./config/var/lists/AdguardDNS-*.txt
    - ./config/var/lists/Easylist-*.txt
    - ./config/var/lists/Prigent-Ads-*.txt
    - ./config/var/lists/Prigent-Malware-*.txt
    - ./config/block.txt
    allowed_domains_files:
    - ./config/allow.txt
- type: upstream
  config:
    routes:
    - domain: internal.example
      upstreams:
      - host: 10.0.0.2
        port: 53
      - host: 10.0.0.3
        port: 53
    - suffix: corp
      upstreams:
      - host: 10.0.1.1
        port: 53
- type: greylist
  config:
    duration_seconds: 3600
    db_path: ./config/var/greylist.db
- type: new_domain
  config:
    threshold_days: 14
    whois_db_path: ./config/var/whois_cache.db
- type: etc-hosts
  config:
    file_paths:
    - /etc/hosts
- type: router
  config:
    routes: []
server:
  listen:
    udp:
      enabled: true
      host: 127.0.0.1
      port: 5335
    tcp:
      enabled: false
      host: 127.0.0.1
      port: 5335
    dot:
      enabled: false
      host: 127.0.0.1
      port: 8853
    doh:
      enabled: false
      host: 127.0.0.1
      port: 5380
  cache:
    module: in_memory_ttl
    config:
      min_cache_ttl: 60
  dnssec:
    mode: ignore
    validation: upstream_ad
    udp_payload_size: 1232
  resolver:
    timeout_ms: 2000
    use_asyncio: true
  http:
    enabled: false
    host: 127.0.0.1
    port: 5380
    logs:
      buffer_size: 500
    system_info_ttl_seconds: 2.0
    system_metrics_detail: full
    debug_timings: false
    index: true
    auth:
      mode: none
    cors:
      enabled: false
      allowlist: []
    redact_keys:
    - token
    - password
    - secret
stats:
  enabled: false
  interval_seconds: 300
  reset_on_log: false
  include_qtype_breakdown: true
  include_top_clients: true
  include_top_domains: true
  top_n: 10
  track_latency: true
  force_rebuild: false
  persistence:
    enabled: true
    db_path: ./config/var/stats.db
    batch_writes: true
    batch_time_sec: 15.0
    batch_max_size: 1000
  ignore:
    top_clients: []
    top_domains: []
    top_subdomains: []
    top_domains_mode: exact
    top_subdomains_mode: exact
    ignore_single_host: false
