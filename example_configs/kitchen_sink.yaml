# config.yaml – defaults for Foghorn with a minimal plugin set
# Below are the defaults

listen:
  udp:
    enabled: true
    host: 127.0.0.1
    port: 5333
  tcp:
    enabled: false
    host: 127.0.0.1
    port: 5333
  dot:
    enabled: false
    host: 127.0.0.1
    port: 8853
    # cert_file: /path/to/cert.pem
    # key_file: /path/to/key.pem
  doh:
    enabled: false
    host: 127.0.0.1
    port: 8053
    # cert_file: /path/to/cert.pem
    # key_file: /path/to/key.pem

upstream:
  # UDP upstream
  - host: 8.8.8.8
    port: 53
    transport: udp

  # TCP upstream
  - host: 8.8.4.4
    port: 53
    transport: tcp
    pool:
      max_connections: 32
      idle_timeout_ms: 15000

  # DoT upstream (DNS-over-TLS)
  - host: 1.1.1.1
    port: 853
    transport: dot
    tls:
      server_name: cloudflare-dns.com
      verify: true
      # ca_file: /etc/ssl/certs/ca-certificates.crt
    pool:
      max_connections: 64
      idle_timeout_ms: 30000

  # DoH upstream (DNS-over-HTTPS)
  - transport: doh
    url: https://dns.google/dns-query
    method: POST
    headers:
      user-agent: foghorn
    tls:
      verify: true
      # ca_file: /etc/ssl/certs/ca-certificates.crt

timeout_ms: 2000
min_cache_ttl: 60

dnssec:
  mode: ignore
  validation: upstream_ad
  udp_payload_size: 1232

logging:
  level: info
  stderr: true
  # file: /var/log/foghorn/foghorn.log
  # syslog: true

statistics:
  enabled: false
  interval_seconds: 300        # 5 minutes
  reset_on_log: false
  include_qtype_breakdown: true
  include_top_clients: true
  include_top_domains: true
  top_n: 10
  track_latency: true

  persistence:
    enabled: true
    db_path: ./config/var/stats.db
    batch_writes: true
    batch_time_sec: 15.0
    batch_max_size: 1000

  ignore:
    top_clients: []
    top_domains: []
    top_subdomains: []
    top_domains_mode: exact
    top_subdomains_mode: exact
    ignore_single_host: false

webserver:
  enabled: false
  host: 127.0.0.1
  port: 8053
  logs:
    buffer_size: 500
  system_info_ttl_seconds: 2.0
  system_metrics_detail: full
  debug_timings: false
  index: true

  auth:
    mode: none
    # token: "change-me"

  cors:
    enabled: false
    allowlist: []

  redact_keys:
    - token
    - password
    - secret

plugins:
  # 1) /etc/hosts resolver – answers from hosts files first when possible
  - module: hosts
    pre_priority: 10           # run early
    config:
      # Default is ['/etc/hosts'] if both unset; you can add more files:
      # file_paths:
      #   - /etc/hosts
      #   - /etc/hosts.d/extra
      watchdog_enabled: true

  # 2) Filter plugin – allow/block domains and IPs
  - module: filter
    pre_priority: 20
    post_priority: 20
    config:
      cache_ttl_seconds: 600
      db_path: ./config/var/blocklist.db
      default: deny            # deny if not explicitly allowed
      clear: 1                 # drop & rebuild DB on startup

      # Inline allow/block (start empty)
      allowed_domains: []
      blocked_domains: []

      # File-backed allow/block lists (you can create these files later)
      allowlist_files:
        - ./config/allow.txt
      blocklist_files:
        - ./config/block.txt
      allowed_domains_files: []
      blocked_domains_files: []

      # Patterns and keywords (inline and file-backed)
      blocked_patterns: []
      blocked_keywords: []
      blocked_patterns_files: []
      blocked_keywords_files: []

      # IP-based rules (inline and file-backed)
      blocked_ips: []
      blocked_ips_files: []

  # 3) Upstream router – send certain suffixes to specific upstreams
  - module: router
    pre_priority: 30
    config:
      routes:
        # Example: internal corp domains to some internal resolver
        # - suffix: corp.internal
        #   upstreams:
        #     - host: 10.0.0.1
        #       port: 53
        #     - host: 10.0.0.2
        #       port: 53
        #
        # Example: lab domains to a lab resolver
        # - suffix: lab.local
        #   upstreams:
        #     - host: 192.168.1.1
        #       port: 53
        []
