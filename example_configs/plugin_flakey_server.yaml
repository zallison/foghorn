# Foghorn example: Flakey server plugin
# Introduce controlled failures for testing resilience and clients' retry behavior.

listen:
  udp:
    enabled: true
    host: 127.0.0.1
    port: 5353
  tcp:
    enabled: false
  dot:
    enabled: false

upstream:
  - host: 1.1.1.1
    port: 53
  - host: 8.8.8.8
    port: 53

dnssec:
  mode: passthrough
  validation: upstream_ad
  udp_payload_size: 1232

timeout_ms: 2000
logging:
  level: info

plugins:
  - module: flakey  # FlakeyServer alias
    # pre_priority: 15  # optional: run early so failures happen before other plugins
    config:
      # Only apply flakey behavior to these client subnets:
      allow:
        - 192.0.2.0/24
        - 2001:db8::/32

      # Probability controls: "one in N" chance of returning the error
      servfail_one_in: 4   # ~25% SERVFAIL
      nxdomain_one_in: 10  # ~10% NXDOMAIN

      # Limit to certain query types
      apply_to_qtypes: ["A", "AAAA"]

      # Optional deterministic seed for reproducible runs
      # seed: 12345
