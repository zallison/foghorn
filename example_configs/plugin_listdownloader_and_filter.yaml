# Example config: use ListDownloaderPlugin to fetch lists, then Filter to load them

listen:
  udp:
    enabled: true
    host: 127.0.0.1
    port: 5353

upstream:
  - { host: 1.1.1.1, port: 53 }
  - { host: 8.8.8.8, port: 53 }

dnssec:
  mode: passthrough
  validation: upstream_ad
  udp_payload_size: 1232

timeout_ms: 2000
logging:
  level: info

plugins:
  # 1) Download well-known domain-only blocklists to ./config/var/lists.
  # Runs early in the setup phase so files are present before Filter runs.
  - module: list_downloader
    config:
      setup_priority: 15  # lower runs earlier during setup()
      download_path: ./config/var/lists
      # Optionally refresh no more than once per day during runtime
      interval_days: 1
      urls:
        # Firebog curated domain-only lists
        - https://v.firebog.net/hosts/AdguardDNS.txt
        - https://v.firebog.net/hosts/Easylist.txt
        - https://v.firebog.net/hosts/Prigent-Ads.txt
        - https://v.firebog.net/hosts/Prigent-Malware.txt

  # 2) Filter consumes those files as blocklists.
  - module: filter
    config:
      setup_priority: 20  # run setup after list_downloader
      default: deny
      db_path: ./config/var/blocklist.db
      cache_ttl_seconds: 600

      # Inline rules (optional)
      # blocked_domains: [ 'tracker.example' ]
      # allowed_domains: [ 'intranet.example' ]

      # Domain lists produced by the downloader above
      blocklist_files:
        - ./config/var/lists/AdguardDNS.txt
        - ./config/var/lists/Easylist.txt
        - ./config/var/lists/Prigent-Ads.txt
        - ./config/var/lists/Prigent-Malware.txt
