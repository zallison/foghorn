# Foghorn example: Examples plugin
# Demonstrates request filtering and simple response rewrite.

listen:
  udp:
    enabled: true
    host: 127.0.0.1
    port: 5353
  tcp:
    enabled: false
  dot:
    enabled: false

upstream:
  - host: 1.1.1.1
    port: 53
  - host: 8.8.8.8
    port: 53

dnssec:
  mode: passthrough
  validation: upstream_ad
  udp_payload_size: 1232

timeout_ms: 2000
logging:
  level: info

plugins:
  - module: examples  # ExamplesPlugin alias
    # pre_priority: 60
    # post_priority: 90  # optional: perform rewrites late
    config:
      # Pre-filtering knobs
      max_subdomains: 5
      max_length_no_dots: 50
      base_labels: 2
      apply_to_qtypes: ["*"]

      # Post-response rewrite example: override first IPv4 answer
      rewrite_first_ipv4:
        - apply_to_qtypes: ["A"]
          ip_override: "127.0.0.1"
        # - apply_to_qtypes: ["AAAA"]
        #   ip_override: "::1"

      # Notes:
      # - Pre-filter checks run before upstream resolution.
      # - Rewrites occur after an answer is received (post-processing).

---
# Foghorn example: CustomRecords plugin
# Demonstrates serving static DNS records from a local file.

listen:
  udp:
    enabled: true
    host: 127.0.0.1
    port: 5353

upstream:
  # Upstream is still required for names not covered by CustomRecords.
  - host: 1.1.1.1
    port: 53

logging:
  level: info

timeout_ms: 2000

plugins:
  - module: custom  # CustomRecords alias
    config:
      # Provide one or more records files; lines use:
      #   <domain>|<qtype>|<ttl>|<value>
      # example.com|A|300|192.0.2.10
      file_paths:
        - ./config/custom-records.txt

      # Optional: enable live reloads when the records file changes.
      watchdog_enabled: true
      watchdog_min_interval_seconds: 1.0
      # polling can help in container / network FS setups where events are flaky
      watchdog_poll_interval_seconds: 0.0
